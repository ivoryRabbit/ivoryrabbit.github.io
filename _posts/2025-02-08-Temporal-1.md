---
title:        Temporal 뜯어보기 (1)
date:         2025-02-08
categories:   [Data, Engineering]
tags:         [Nessie, Iceberg, Data lake]
comments:     true
---

<style>
H2 { color: #298294 }
H3 { color: #1e7ed2 }
H4 { color: #C7A579 }
</style>


# (WIP)

## Temporal란?

Temporal은
- duable execution platform
- 오픈소스
- 비동기
- 마이크로서비스 오케스트레이션
- 워크플로우 실행 관리
- 분산 시스템

- [Temporal Github](https://github.com/temporalio/temporal){: target="_blank"}

목적
- 실패하지 않아야할 로직을 안정적으로 실행하기 위함
- 회복이 가능한(resilient) 처리 (실패하면 재실행)
- 장기간 실행되어야 하는 작업에 유리 (long-running task)

특징
- Fault Tolerance(내결함성)
   -  작업이 실패하더라도 자동으로 재실행하고, 중단된 부분 부터 다시 실행
- State Management(상태 관리)
   - 워크플로우의 상태를 자동으로 저장하고 필요시 복원
   - 장애 처리가 쉽다
- Scalability(확장성)
   - 분산 환경을 지원
   - 나중에 설명하겠지만, 다수의 worker에 대한 로드밸런싱 지원
- 다양한 언어에 대해 SDK 지원
   - Go, Java, Python, PHP, Typescript, .Net
- Event driven processing
   - 메시지 브로커를 두어 이벤트 기반 시스템 구축 가능
   - 워크플로우 상태가 비동기적으로 유지

탄생
- Uber의 Cadence라는 프레임워크로부터 탄생
   - Cadence는 비동기 워크플로우 프레임워크
   - Cadence를 살펴보면 workflow / activity 구조가 Cadence로부터 비롯되었음을 알 수 있음

비교군
- Apache Airflow
   - Airflow는 스케쥴링에 좀 더 치중
   - 느낌상 Temporal이 Airflow보다 가벼움
   - Airflow는 로직을 remote 환경(worker 또는 외부 container)에서 실행
   - Temporal은 client에서도 로직 실행 가능 (서버는 상태만 관리)
- AWS Step Functions
   - AWS의 워크플로우 서비스
   - 사용하는 걸 본적만 있고 써본 적 없음
   - 클라우드 서비스이므로 Vendor Lock-in이 있을듯
- 그 외
   - Jenkins Workflow
   - Luigi
      - Spotify에서 만든 Python 워크플로우 엔진
      - 써본적은 있는데 airflow로 금방 migration 했었음

Main component
- Temporal server
   - 워크플로우 생성과 실행을 관리, 상태 유지
   - 워크플로우를 직접 실행하는게 아님에 주의
   - 컨트롤 플레인
- Worker
   - 실제 비지니스 로직이 실행되는 공간
   - Temporal server에서 workflow 또는 activity의 실행을 위임 받음
      - 일반적으로 gRPC 통신 사용
- Client SDK
   - SDK를 통해 Temporal server와 상호 작용
   - 비지니스 로직을 작성하고 workfow 또는 activity를 실행
- Persistence Layer
   - 워크플로우의 상태를 저장
   - 현재 다음 DB들이 사용 가능
      - MySQL
      - PostgresQL
      - Cassandra
   - 워크플로우 검색 기능을 위해 optional로 사용 가능
      - Elasticsearch

사용 예시
- Reliable 시스템
   - 실패하면 재실행하거나 이전 상태로 복구되어야 하는 로직에 사용 가능
   - 예) 주문 처리 시스템
- 이벤트 기반 시스템
   - Kafka 등의 메시지 브로커에서 이벤트가 들어오면 특정 워크플로우를 트리거하는 방식으로 운영 가능
   - 예) 새로운 상품이 생성되면, 상품 설명 데이터로 벡터 임베딩 생성 워크플로우 실행
- SLA 기반 백오피스 작업
   - Data integestion이나 ETL 작업과 같은 Long-running task

통신
- gRPC API
- HTTP gateway
- event streaming

